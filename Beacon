#include <TinyGPS++.h>

//#include <TimerOne.h>
int interruptPin = 20;
int gpsPin = 19;
TinyGPSPlus gps;
double lat;
double lng;
volatile bool ride;

void setup() {
  // put your setup code here, to run once:
  ride = false;
  Serial.begin(9600);
  Serial1.begin(9600);
  attachInterrupt(digitalPinToInterrupt(interruptPin), beginRIDE, RISING);  // Use this to start the R.I.D.E algorithm
  attachInterrupt(digitalPinToInterrupt(gpsPin), receiveGPS, RISING);
}

// Interrupt to receive the GPS readings every tenth of a second
void receiveGPS() {
  while (Serial1.available () > 0) {
     if (gps.encode(Serial1.read() ) ) {
      lat = gps.location.lat();
      lng = gps.location.lng();
      //Serial.println(lat, 6);
      //Serial.println(lng, 6);
    }
  }

}

// When the beacon sends the "start" message, begin the RIDE algorithm
void beginRIDE() {
  ride = true;
  //Serial.println(test);
}

void loop() {

  // Begin the R.I.D.E. algorithm here
  //Serial.println(test);
  //Serial.println(test);
  while (ride) {
    noInterrupts();
    // Take data here:
    Serial.println(lat, 6);
    Serial.println(lng, 6);

    //delay(2000); // delay here to test
    interrupts();
  }

}
